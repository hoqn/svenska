---
title: "Astro에서의 style 처리 과정"
subtitle: "처리 과정에 따라 패키지 해석이 달라진다."
created_at: 2023-11-11
---

블로그를 수정하다보니 요상한 일이 일어났다. 분명 방금까지만 해도 잘 적용됐던 스타일들이 갑자기 전혀 동작하지 않는 것이다. 대체 무슨 일일까 싶어 몇 시간 동안 뭐가 문제일까 찾아보았다.

#### 분석

일단, 문제가 생기는 특징은 아래와 같았다.

- `*.md`로 구성된 페이지는 정상적으로 렌더링되었다.
- `*.astro`로 구성된, `Collection`을 불러오는 페이지는 스타일이 전혀 적용되지 않았다.
- `*.astro`로 구성되었지만, `Collection`을 불러오지 않고 정적인 페이지는 정상적으로 렌더링되었다.

즉, 그 페이지를 렌더링하기 위해 사전 작업이 필요한 페이지는 스타일이 적용되지 않았고, 페이지를 렌더링하기 위해 사전 작업이 필요없이 그대로 HTML로 변환만 하면 되는 페이지는 스타일이 문제 없이 적용되었다.

무엇이 문제일까…

사실 이 현상이 발생한 시점이 패키지 매니저를 pnpm에서 yarn stable(berry)로 옮긴 시점이었다. 따라서 패키지 매니저의 문제리라 짐작하고 열심히 해결방법을 찾고 있었다. 그러나, 아무리 해결하려 애써도 다른 문제만 더 생길 뿐이었다. 하지만 그 와중 얻은 단서가 있었다.

왜인지는 모르겠으나, yarn berry나 pnpm 환경에서 실행했을 때는 아무런 에러 없이 동작했지만 스타일만 적용되지 않았던 반면, yarn classic 환경에서 실행했을 때는 (그 전에는 스타일이 적용되지 않았을 뿐 빌드는 되었을) 페이지를 렌더링하던 중 에러를 뿜으며 멈춰버렸다! 바로 아래의 에러 메시지와 함께.

> Failed to resolve entry for package "color".

`color`?? 처음엔 `color`라는 어떤 내부 의존 패키지가 있고 그 부분에서 문제가 있을까 생각했다. 하지만 곧, scss와 관련이 있지 않을까 생각됐다. 내가 scss에서 색깔을 공통적으로 관리하기 위해 `_color.scss`에 색깔 유틸을 담아놓고 `@use "@/styles/color"`로 쓰고 있었기 때문이다. 생각해보니, 마침 패키지 매니저를 바꿀 때쯤 `@use "../styles/color as color"`와 같이 상대경로로 사용하던 구문들을 모두 `@use "@/styles/color"`로 바꿔주었었다. 당연히, `vite` 설정에서 `css.preprocessorOptions.includePaths`에 해당 경로를 추가해놨었기 때문에, 아주 자연스러운 변경이었다.

#### 결론

허무하게도, 이 부분을 다시 상대 경로로 바꿔주니 문제가 사라졌다. 또는, 문제가 되는 페이지들에 대해서는 TypeScript 절대 경로로 입력해도 작동했다. 예컨대, 나는 `src/`를 `@/`로 쓰고 있었는데, `@/styles/color`와 같이 바꿔도 문제가 없었다. 그렇다면… 해당 페이지들은 다른 경로로 해석된다고 유추할 수 있었다.

#### 그렇다면 Astro에서 Style의 해석은 어떤 스코프에서 일어나는 것일까?

Astro 관련 문서를 열심히 찾아보았다.

